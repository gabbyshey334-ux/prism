# OAuth Configuration Guide for Prism App Production

This guide explains how to update your OAuth applications with the correct prism-app.com domain configuration.

## Overview

Your Prism app is configured to use the following domains:
- **Production Backend**: `https://api.prism-app.com`
- **Production Frontend**: `https://prism-app.com`
- **Staging Environment**: `https://staging.prism-app.com`

You need to update all your OAuth applications to use the new redirect URLs.

## OAuth Redirect URLs

### Production Environment
The base URL for production backend is: `https://api.prism-app.com`

Generic OAuth Redirect URL Pattern:
```
https://api.prism-app.com/auth/{provider}/callback
```

### Staging Environment
The base URL for staging backend is: `https://staging.prism-app.com`

Generic OAuth Redirect URL Pattern:
```
https://staging.prism-app.com/auth/{provider}/callback
```

Where `{provider}` is one of: `google`, `twitter`, `linkedin`, `facebook`, `instagram`, `tiktok`, `youtube`, `threads`

## Platform-Specific Instructions

### Google OAuth

1. **Go to Google Cloud Console**: https://console.cloud.google.com/
2. **Navigate to**: APIs & Services → Credentials
3. **Find your OAuth 2.0 Client ID** (or create a new one)
4. **Update "Authorized redirect URIs"**:
   ```
   https://api.prism-app.com/auth/google/callback
   https://staging.prism-app.com/auth/google/callback
   ```
5. **Update "Authorized JavaScript origins"**:
   ```
   https://api.prism-app.com
   https://staging.prism-app.com
   https://prism-app.com
   ```
6. **Save changes**

### Twitter OAuth

1. **Go to Twitter Developer Portal**: https://developer.twitter.com/
2. **Navigate to**: Projects & Apps → Your App → Settings
3. **Update "Callback URLs"**:
   ```
   https://api.prism-app.com/auth/twitter/callback
   https://staging.prism-app.com/auth/twitter/callback
   ```
4. **Update "Website URL"**:
   ```
   https://prism-app.com
   ```
5. **Save changes**

### LinkedIn OAuth

1. **Go to LinkedIn Developers**: https://www.linkedin.com/developers/
2. **Navigate to**: My Apps → Your App → Auth
3. **Update "Authorized redirect URLs for your app"**:
   ```
   https://api.prism-app.com/auth/linkedin/callback
   https://staging.prism-app.com/auth/linkedin/callback
   ```
4. **Update "JavaScript API domains"**:
   ```
   prism-app.com
   api.prism-app.com
   staging.prism-app.com
   ```
5. **Save changes**

### Facebook OAuth

1. **Go to Facebook Developers**: https://developers.facebook.com/
2. **Navigate to**: My Apps → Your App → Facebook Login → Settings
3. **Update "Valid OAuth Redirect URIs"**:
   ```
   https://api.prism-app.com/auth/facebook/callback
   https://staging.prism-app.com/auth/facebook/callback
   ```
4. **Update "App Domains"**:
   ```
   prism-app.com
   api.prism-app.com
   staging.prism-app.com
   ```
5. **Save changes**

### Instagram Basic Display API

1. **Go to Facebook Developers**: https://developers.facebook.com/
2. **Navigate to**: My Apps → Your App → Instagram Basic Display → Basic Display
3. **Update "Valid OAuth Redirect URIs"**:
   ```
   https://api.prism-app.com/auth/instagram/callback
   https://staging.prism-app.com/auth/instagram/callback
   ```
4. **Save changes**

### TikTok OAuth

1. **Go to TikTok Developer**: https://developers.tiktok.com/
2. **Navigate to**: My Apps → Your App → Configuration
3. **Update "Redirect domain"**:
   ```
   https://api.prism-app.com/auth/tiktok/callback
   https://staging.prism-app.com/auth/tiktok/callback
   ```
4. **Save changes**

### YouTube OAuth

1. **Go to Google Cloud Console**: https://console.cloud.google.com/
2. **Navigate to**: APIs & Services → Credentials
3. **Find your OAuth 2.0 Client ID**
4. **Update "Authorized redirect URIs"**:
   ```
   https://api.prism-app.com/auth/youtube/callback
   https://staging.prism-app.com/auth/youtube/callback
   ```
5. **Save changes**

### Threads OAuth

1. **Go to Meta for Developers**: https://developers.facebook.com/
2. **Navigate to**: My Apps → Your App → Products → Threads API
3. **Update "OAuth redirect URIs"**:
   ```
   https://api.prism-app.com/auth/threads/callback
   https://staging.prism-app.com/auth/threads/callback
   ```
4. **Save changes**

## Environment Variables Update

Make sure your `.env` file includes the correct redirect URLs:

```bash
# Frontend URLs
FRONTEND_URL=https://prism-app.com
BACKEND_URL=https://api.prism-app.com
STAGING_URL=https://staging.prism-app.com

# CORS Origins (multiple domains supported)
CORS_ORIGIN=https://prism-app.com,https://staging.prism-app.com

# Email configuration
FROM_EMAIL=noreply@prism-app.com

# OAuth Redirect URLs (these are automatically generated by the app)
# Production: https://api.prism-app.com/auth/{provider}/callback
# Staging: https://staging.prism-app.com/auth/{provider}/callback
```

## Testing OAuth Integration

After updating your OAuth configurations:

1. **Restart your application**:
   ```bash
   docker-compose restart
   ```

2. **Test each OAuth provider**:
   - Navigate to `https://prism-app.com/login` (production)
   - Navigate to `https://staging.prism-app.com/login` (staging)
   - Click on each social login button
   - Complete the authorization flow
   - Verify successful login

3. **Check logs for errors**:
   ```bash
   docker-compose logs backend | grep -i oauth
   docker-compose logs backend | grep -i auth
   ```

## Common Issues and Solutions

### "redirect_uri_mismatch" Error

**Problem**: OAuth provider reports redirect URI mismatch

**Solution**: 
1. Double-check the exact URL in your OAuth app settings
2. Ensure HTTPS is used (not HTTP)
3. Check for trailing slashes
4. Verify the callback URL matches exactly

### "unauthorized_client" Error

**Problem**: Client ID or secret is incorrect

**Solution**:
1. Verify client ID and secret in your `.env` file
2. Ensure OAuth app is published/approved (for production)
3. Check if the app is in development mode

### SSL Certificate Issues

**Problem**: OAuth providers require HTTPS

**Solution**:
1. Ensure SSL certificates are properly configured
2. Test with: `curl -I https://api.prism-app.com/health`
3. Check certificate expiration: `docker-compose exec certbot certbot certificates`

### CORS Issues

**Problem**: Cross-origin requests blocked

**Solution**:
1. Update `CORS_ORIGIN` in `.env` to include all your domains
2. Restart the application
3. Check NGINX CORS headers in the configuration
4. Verify all domains are included: `https://prism-app.com,https://staging.prism-app.com`

## Verification Checklist

- [ ] All OAuth apps updated with new redirect URLs
- [ ] Both production and staging URLs configured (if using staging)
- [ ] Environment variables configured correctly
- [ ] SSL certificates installed and valid for all domains
- [ ] DNS records pointing to correct IPs
- [ ] Application restarted after changes
- [ ] Each OAuth provider tested successfully
- [ ] Logs show no authentication errors
- [ ] CORS configuration includes all domains

## Next Steps

After OAuth configuration is complete:

1. **Test the complete user flow** from registration to posting
2. **Verify scheduled posting** functionality works
3. **Check background workers** are processing jobs
4. **Monitor application logs** for any authentication issues
5. **Set up monitoring alerts** for OAuth failures
6. **Test staging environment** if applicable

## Support

If you encounter issues:

1. **Check application logs**: `docker-compose logs backend`
2. **Verify OAuth URLs**: Ensure they match exactly
3. **Test SSL**: `curl -I https://api.prism-app.com/health`
4. **Check DNS**: `nslookup api.prism-app.com`
5. **Review OAuth app settings**: Double-check all configurations
6. **Verify CORS**: Check that all domains are properly configured

For platform-specific OAuth issues, consult the official documentation:
- Google: https://developers.google.com/identity/protocols/oauth2
- Twitter: https://developer.twitter.com/en/docs/authentication/oauth-2-0
- LinkedIn: https://docs.microsoft.com/en-us/linkedin/shared/authentication/authorization-code-flow
- Facebook: https://developers.facebook.com/docs/facebook-login/manually-build-a-login-flow